# 游戏攻略/STG常用工具/VsyncPatch/vpatch_readme_th15

<!-- source html: G:\repos\THBWiki-Markdown-Builder\THBWikiMarkdown\Temp\main\a\a9\ns0%3A%E6%B8%B8%E6%88%8F%E6%94%BB%E7%95%A5%2FSTG%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%2FVsyncPatch%2Fvpatch_readme_th15.html -->

使用了翻译表的页面

- 纯文本格式（Wiki系统将从本页面下方的翻译表中自动获取内容并拼接成纯文本格式的页面）

: [日文版](http://omake.thwiki.cc/translate.php?u=游戏攻略/STG常用工具/VsyncPatch/vpatch_readme_th15&amp;t=ja)
: [汉化版](http://omake.thwiki.cc/translate.php?u=游戏攻略/STG常用工具/VsyncPatch/vpatch_readme_th15&amp;t=zh)

  
  

  


<table><tbody><tr class="tt-content" id="=-1" data-pos="&#91;&quot;=&quot;,1&#93;"><td class="tt-ja" lang="ja"><div class="poem">VsyncPatch</div></td><td class="tt-zh" lang="zh"><div class="poem">VsyncPatch<br></div></td></tr><tr class="tt-content" id="=-2" data-pos="&#91;&quot;=&quot;,2&#93;"><td class="tt-ja" lang="ja"><div class="poem">基本的な使用方法は、VsyncPatch rev6と同じです<br>使用方法の詳細は、rev6のreadmeを御覧下さい</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-3" data-pos="&#91;&quot;=&quot;,3&#93;"><td class="tt-ja" lang="ja"><div class="poem">■対応OS<br>確認済：Windows 7 64bit版<br>vista以上対応(xp以前は非対応)</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-4" data-pos="&#91;&quot;=&quot;,4&#93;"><td class="tt-ja" lang="ja"><div class="poem">■対応ゲーム<br>東方紺珠伝 ver1.00b</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-5" data-pos="&#91;&quot;=&quot;,5&#93;"><td class="tt-ja" lang="ja"><div class="poem">■警告<br>本非公式パッチは、ゲームの内部動作を大幅に変更します<br>本パッチを当てると不具合がでるかもしれません<br>実行前にscore.dat等をバックアップすることを推奨します<br>また、十分に動作確認をした上でご使用ください<br>特に本パッチを使用した状態でリプレイを保存、公開される方はご注意ください<br>本パッチ適用時のリプレイに関しては、東方Projectスコアボードに投稿することはできません<br>リプレイをwebやuploder等で公開する場合は、VsyncPatchを使用していることを明記すると、<br>トラブルになりにくいかと思います<br>本パッチは非公式に作成したものです<br>公式に問い合わせないようにお願いします</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-6" data-pos="&#91;&quot;=&quot;,6&#93;"><td class="tt-ja" lang="ja"><div class="poem">■再配布<br>ご自由に再配布してくださってかまいません<br>ただし、zip内のファイルを変更・追加せず<br>そのままの状態で再配布をお願いします</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-7" data-pos="&#91;&quot;=&quot;,7&#93;"><td class="tt-ja" lang="ja"><div class="poem">■インストール<br>vpatch.exe、vpatch_th??.dll、vpatch.iniのファイルを<br>東方シリーズをインストールしたフォルダにコピーしてください<br>iniファイルは無くても一応動作します</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-8" data-pos="&#91;&quot;=&quot;,8&#93;"><td class="tt-ja" lang="ja"><div class="poem">東方紺珠伝の場合はvpatch.exeとvpatch_th15.dllとvpatch.ini</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-9" data-pos="&#91;&quot;=&quot;,9&#93;"><td class="tt-ja" lang="ja"><div class="poem">※パッチの動作不良で、score.dat等がおかしくなる可能性もあるかもしれません<br>※念のためバックアップをとってからパッチを実行するようにしてください<br>※vpatch.exeは、vpatchという名のつくdllを同じフォルダ内で検索し、<br>※最初に見つかったdllをロードします<br>※したがって、同じフォルダ内に別のvpatch dllがあると、うまく起動できません<br>※東方シリーズをインストールしたフォルダには、<br>※対応しているdllのみを入れるようにしてください</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-10" data-pos="&#91;&quot;=&quot;,10&#93;"><td class="tt-ja" lang="ja"><div class="poem">■アンインストール<br>インストール時にコピーしたexeとdll及びiniファイルを削除してください</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-11" data-pos="&#91;&quot;=&quot;,11&#93;"><td class="tt-ja" lang="ja"><div class="poem">■iniファイル<br>[Option]<br>Vsync (デフォルト=0)<br><br>　0を指定すると垂直同期をせずに、描画を行います<br>　高fpsで安定させることができる代わりに、ティアリング(ちらつき)が発生する可能性があります<br><br>　1を指定すると独自の方法で垂直同期をとり、描画を行います<br>　Gameの速度(fps)は、モニタのリフレッシュレートと同じになります<br>　Vsync=1にしてもティアリング(ちらつき)が発生する場合は、<br>　FlushGpuCmdBuffer=1 と D3DMultiThread=1 と AutoBltPrepareTime=1 と ProcessPriority=2 を設定してみてください<br>　OSの設定で、電源プランが「高パフォーマンス」になっていない場合は、「高パフォーマンス」にして、<br>　CPUクロックが低下しないように設定してみてください</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-12" data-pos="&#91;&quot;=&quot;,12&#93;"><td class="tt-ja" lang="ja"><div class="poem">FlushGpuCmdBuffer (デフォルト=0)<br><br>　1にすると、画面を更新する直前に、GPUのコマンドバッファを強制的にフラッシュし、ただちにGPUに描画命令を送信するようにします<br>　LockBackBufferとよく似たオプションです<br>　LockBackBufferの効果が無い場合は、LockBackBufferの代わりにFlushGpuCmdBufferを試してください</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-13" data-pos="&#91;&quot;=&quot;,13&#93;"><td class="tt-ja" lang="ja"><div class="poem">LockBackBuffer (デフォルト=0)<br><br>　1にすると、画面を更新する直前にバックバッファをロックし、すべてのDirect3D描画命令の完了を待機します<br>　vsync=1時に、ティアリングが発生する環境では、LockBackBuffer=1にすることで正常にvsyncが行えるようになるかもしれません<br>　LockBackBufferの効果がない場合は、代わりにFlushGpuCmdBufferを試してください</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-14" data-pos="&#91;&quot;=&quot;,14&#93;"><td class="tt-ja" lang="ja"><div class="poem">BltPrepareTime (デフォルト=0)<br><br>　実際に画面に表示される何ミリ秒(ms)前に、<br>　裏画面に次のフレームを描画し始めるかを指定します<br>　0～16の数字を指定してください<br><br>　例：BltPrepareTime=10を指定すると、10ms前にゲームループ(描画)を開始し、例えば3msで1フレームを描画できた場合は、<br>　残りの7msをsleepしてから、規定の時刻に画面を更新します<br><br>　1フレームを描画する時間はまちまちなため、多めの時間をBltPrepareTimeに設定すると、<br>　vsync=1の時にティアリング発生を少なくすることができます<br><br>　vsync=0の時は、BltPrepareTime=0でもかまいませんが、多めの時間を設定することで、<br>　常に一定のリズムで画面更新を行うことができます<br>　vsync=0なのでティアリングは発生しますが、常に同じリズムでティアリングが発生するようになることで、<br>　画面が見やすくなるかもしれません　　その代わり入力遅延がBltPrepareTimeに設定した値になります<br><br>　例えば、弾の多いシーンではゲームループ(描画処理)だけで5ms以上かかるので、BltPrepareTimeを4に設定したとしても、<br>　元から入力遅延は5ms存在しますので、BltPrepareTimeの設定で増える入力遅延は実質0です<br>　BltPrepareTimeの値の分、そのまま入力遅延が必ず増えるわけではありません<br><br>　最近のOSでは、GPUのコマンドバッファは画面を更新する際にフラッシュするようになっているため、<br>　画面を更新する前にsleepしても、GPUに命令が送信されずに無為に時間を費やすだけです<br>　BltPrepareTimeだけを設定しても入力遅延や描画遅延が増えるだけで効果はありません<br>　BltPrepareTimeを設定する場合は、FlushGpuCmdBufferを1にして強制的にGPUのコマンドバッファをフラッシュするように設定してください</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-15" data-pos="&#91;&quot;=&quot;,15&#93;"><td class="tt-ja" lang="ja"><div class="poem">AutoBltPrepareTime (デフォルト=0)<br><br>　0を指定した場合は、何もしません<br>　1を指定すると、描画完了時間の統計を取り、最適なBltPrepareTimeを自動でセットします<br>　AutoBltPrepareTimeを1以上にすると、この値のミリ秒分、自動算出された値に加算されます<br>　AutoBltPrepareTimeを設定する場合は、FlushGpuCmdBufferを1にしてください(BltPrepareTimeのヘルプに書いた理由と同じです)<br>　vsync=0の時は、AutoBltPrepareTime=0でかまいません<br>　vsync=1の時に、AutoBltPrepareTime=1を推奨します</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-16" data-pos="&#91;&quot;=&quot;,16&#93;"><td class="tt-ja" lang="ja"><div class="poem">D3DMultiThread (デフォルト=1)<br><br>　Direct3Dをマルチスレッドで動作させた場合に発生する不具合を無くすためのオプションです<br>　0の場合は、何もしません<br><br>　1の場合、IDirect3D9::CreateDevice() のBehaviorFlagsに、D3DCREATE_MULTITHREADEDを指定するようにします<br>　このフラグを指定すると、マルチスレッドでDirect3Dを使用する際に不正終了しなくなります<br><br>　vsync=1の時には、スキャンラインの位置を調査するスレッドを起動するため、このオプションの設定が必要です</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-17" data-pos="&#91;&quot;=&quot;,17&#93;"><td class="tt-ja" lang="ja"><div class="poem">FixSlowPauseScreen (デフォルト=1)<br><br>　1を指定すると、ゲーム中、一時停止画面が表示される際にfpsが大幅に低下する動作を修正するパッチを当てます<br>　startボタンを連打しても、おそらく60fpsをキープできると思います<br>　パッチの詳細は下記の通りです<br>　一時停止画面を生成する際、テクスチャーの色変換にD3DX関数が使用されており、<br>　その転送元にバックバッファが直接指定されています<br>　このD3DX関数は転送元SurfaceをLockしてピクセルを直接readするような実装のようです<br>　バックバッファをLockして直接readするのはとても遅いためfpsが異常に低下します<br>　パッチでは、バックバッファの内容をメインメモリに用意したSurfaceにコピーし、<br>　そのコピーしたSurfaceを代わりに転送元として指定しD3DX関数をcallします<br>　メインメモリに用意したSurfaceのLock＆readはとても高速に動作するため、<br>　fpsの低下はある程度押さえられます(CPU&amp;GPUの性能に左右)</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-18" data-pos="&#91;&quot;=&quot;,18&#93;"><td class="tt-ja" lang="ja"><div class="poem">DisableChecksum (デフォルト=0)<br><br>　東方の実行ファイルであるth15.exeのチェックサムを確認するかどうかの設定です<br>　1を設定すると、チェックサムを確認せずにvpatchを適用し、東方を起動します<br>　通常はこのオプションを変更する必要はありません<br>　東方の実行ファイルに何らかの非公式パッチ(言語パッチ・不具合解消パッチ等)を当てた場合は、このオプションを1にしてください<br>　1に設定した場合、vpatchが正常に動作するかどうかはわかりません<br>　※vpatchが適用できない場合は、まず、ゲームのバージョンが対応verであるかどうかを確認してください</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-19" data-pos="&#91;&quot;=&quot;,19&#93;"><td class="tt-ja" lang="ja"><div class="poem">ProcessPriority (デフォルト=0)<br>　th??.exeのプロセスの優先度を設定します<br>　0&#160;: 通常<br>　1&#160;: 通常以上<br>　2&#160;: 高<br>　3&#160;: リアルタイム</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-20" data-pos="&#91;&quot;=&quot;,20&#93;"><td class="tt-ja" lang="ja"><div class="poem">ProcessAffinityMask (デフォルト=0)<br>　th??.exeのプロセスの関係(アフィニティ)を設定します<br>　数値は10進数で書いてください<br>　複数のCPUコアに関係付ける場合は足し算をしてください<br>　ここで設定した数値をSetProcessAffinityMask関数に渡します<br>　0&#160;: 設定なし(すべてのプロセッサ)<br>　1&#160;: CPU 0<br>　2&#160;: CPU 1<br>　4&#160;: CPU 2<br>　8&#160;: CPU 3<br>　16: CPU 4</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-21" data-pos="&#91;&quot;=&quot;,21&#93;"><td class="tt-ja" lang="ja"><div class="poem">MainThreadPriority (デフォルト=0)<br>　th??.exeのメインスレッドの優先度を設定します<br>　0&#160;: 通常<br>　1&#160;: 通常以上<br>　2&#160;: 高<br>　3&#160;: タイムクリティカル</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-22" data-pos="&#91;&quot;=&quot;,22&#93;"><td class="tt-ja" lang="ja"><div class="poem">MainThreadAffinityMask (デフォルト=0)<br>　th??.exeのメインスレッドのプロセスの関係(アフィニティ)を設定します<br>　設定方法はProcessAffinityMaskと同じです</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-23" data-pos="&#91;&quot;=&quot;,23&#93;"><td class="tt-ja" lang="ja"><div class="poem">MainThreadIdealProcessor (デフォルト=-1)<br>　th??.exeのメインスレッドをどのCPUコアで優先的に実行するのかを設定します<br>　ここで設定した数値をSetThreadIdealProcessor関数に渡します<br>　-1&#160;: すべてのCPUコア<br>　0&#160;: CPU 0<br>　1&#160;: CPU 1<br>　2&#160;: CPU 2<br>　3&#160;: CPU 3<br>　4&#160;: CPU 4</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-24" data-pos="&#91;&quot;=&quot;,24&#93;"><td class="tt-ja" lang="ja"><div class="poem">■version履歴<br>2015/11/28<br>　・東方紺珠伝に対応<br>　・東方紺珠伝以外に対応したvpatchは同梱していません<br>　・ini追加:FlushGpuCmdBuffer<br>　　vsync=1の時にLockBackBuffer=1でバックバッファをロックしても手元の環境では効果が無かったため、<br>　　バックバッファをロックせずに、GPUのコマンドバッファをflushする別の方法を実装しました<br>　・ini追加:MainThreadPriority<br>　・ini追加:MainThreadAffinityMask<br>　・ini追加:MainThreadIdealProcessor<br>　　メインスレッド関連の設定を追加しました<br>　　vsync=1の際には、プロセスを実行するCPUコアを固定した方がティアリングが発生しにくいと思います<br>　　固定するのはメインスレッドだけでよいため、ProcessAffinityMaskで設定するよりも、MainThreadAffinityMaskかMainThreadIdealProcessorで固定すると良いでしょう<br>　・ini追加:FixSlowPauseScreen<br>　　640x480の場合は気になりませんが、1280x960画面の場合、一時停止画面表示時にfpsが大幅に低下するのが気になったので実装しました<br>　・ini:MagnificationMethodは今回は実装できていません<br>　・既知のバグ：FlushGpuCmdBuffer=1にしてフルスクリーンでゲームをした際、デスクトップに戻ってから、ゲームに戻ろうとするとゲームが固まる(又は異常終了する)<br>　　修正には少し時間がかかります<br>　　とりあえずFlushGpuCmdBuffer=0にするか、windowモードでゲームをするか、どちらかの選択肢をお試しください</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-25" data-pos="&#91;&quot;=&quot;,25&#93;"><td class="tt-ja" lang="ja"><div class="poem">■作者<br>◆swmpLV/75E</div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr><tr class="tt-content" id="=-26" data-pos="&#91;&quot;=&quot;,26&#93;"><td class="tt-ja" lang="ja"><div class="poem">■連絡先<br>バグ等の御報告はこちらからどうぞ<br><a rel="nofollow" class="external free" href="http://ux.getuploader.com/swmplv75e/inquire">http://ux.getuploader.com/swmplv75e/inquire</a></div></td><td class="tt-zh" lang="zh"><div class="poem"></div></td></tr></tbody></table>


  
  

  





---

此文档由 [THBWiki-Markdown-Builder](https://github.com/Delsin-Yu/THBWiki-Markdown-Builder) 构建。

文档中的所有内容除特殊注明外，均在 [**知识共享(Creative Commons) 署名-非商业性使用-相同方式共享 3.0 协议**](https://creativecommons.org/licenses/by-sa/3.0/deed.zh-hans) 下提供，附加条款亦可能应用。

引用类型与其他类型作品版权归原作者所有，如有作者授权则遵照授权协议使用。

详细请查阅 [THBWiki：免责声明](https://thbwiki.cc/THBWiki:%E5%85%8D%E8%B4%A3%E5%A3%B0%E6%98%8E)。

